Red wine Analysis by Saurabh Sarkar
========================================================

Determine the effect of different factors on the quality of Red Wine. We will take a Descriptive Statistical approach here, to describe the collected data. A more complex approach to build a predictor model is well suited for the next phase of analysis

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(gridExtra)
library(RColorBrewer) #Color scheme in the multivariate plot section 
library(dplyr)
```

The collected Red Wine dataset is a basic structure with 1599 indexed observations and 13 variables. Of the 13 variables, there is one which is just the index, leaving 11 features that represent the independent variables and the single target variable or dependent variable, which represents the *quality* score of the wines.

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}
# Load the Data. Set path accordingly
setwd('~/00 Data Analysis/02 Practice/R Studio')
wine <- read.csv('./001data/999wineQualityReds.csv')
#Overview of the data after adjusting datatypes
str(wine)
head(wine)
```

# Explore

We start by looking at the the distribution of the individual variables to determine if the data collected is valid to determine correlation to *quality*. The script below uses the R *summary()* function tot show the IQR and central measures of all the variables. This is a good gauge to determine general distribution and identify possibilities for outliers

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Remove index column
wine <- subset(wine, select = -X)
# Use built in functions to form some basic intuition of the data
names(wine)
summary(wine)
```

**Results**: The *quality* variable is discrete and and as the target variable will be correlated against the 11 different factors. The quality data consists of 6 discrete values with 8 being the highest 3 being the lowest. You can see below that the the most common *quality* values are 5 and 6, where 681 observations have a quality rating of 5 and 638 observations have a quality rating of 6. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
table(wine$quality)
```


The summary showing the median/mean and IQR for the predictive variables indicates that these variables are continuous. Even before we plot histograms for these, we can make some assessments for the skews by looking at the median, mean, and Max/Min values: 

* The following variables [*fixed.acidity, volatile.acidity, citric.acid, residual.sugar*] show median and mean  close to each other indicating a normal distribution, however the relatively higher max value identifies possible outliers. Some of the other factors [*free.sulfur.dioxide, total.sulfur.dioxide, sulphates,alcohol*] indicate similar distributions, but will require further visual represenatations to confirm.
* The remaining factor [*density* and *pH*) do not indicate outliers and have close median and mean values, and probably exhibit a normal distribution

We will confirm these findings in the next section, by observing the distribution of each variable by plotting histograms.

# Univariate Plots Section

In this section we will show the visual distribution of the individual variables and identify if transformations are needed before we start observing correlations. In this section we will better qualify the categories in the depeneant variable *quality*, and then determine the validity of the independent variables to be used to look at correlation to *quality* by observing their distributions. A normal distribution will be a strong candidate to observe further, along with distributions that show a normal behavior once transformed on log scale.

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = quality, data = wine)
```

**Adjust Dependent variable**
The variable *quality* is discrete with most of the data have quality level in the 5 or 6 quality level with a fewer examples for the higher or lower quality scores. To constitute a better frequency for the different categories, it will be beneficial to change the bracket size. It might be beneficial to split this into two brakcets if we were building a logistic regression model. But for descriptive purposes, the *quality* scores will be split into 3 brackets allowing us to better utilize the quality number as a predictor variable for the various wine quality variables. Utilizing basic ifelse statements, the *quality* variable is re-categorized into the 3 segments of *High*, *Average*, and *Low*. The resulting distribution can be seen below.

```{r echo=FALSE, message=FALSE, warning=FALSE}
## Use an ifelse to group the 8 quality values into 3 quality buckets
wine$newQuality = ifelse(wine$quality %in% c(3,4), "low", 
                         ifelse(wine$quality %in% c(5,6), "average", "high"))
# and remove original and replace
wine <- subset(wine, select = -quality)
colnames(wine)[names(wine) == 'newQuality'] <- "quality"
# and convert the three buckets into a ordered factor datatype
wine$quality <- factor(wine$quality)
# NOTE: order the quailty data as by default is lowest to highest
wine$quality <- ordered(wine$quality, levels = c("low", "average", "high"))
qplot(x = quality, data = wine)
```

**Identify Normally distributed variables**
With the dependent variable *quality* re-categorized, we can start the Univariate analysis of the independent variables. We start with *pH* and *density* as they previously indicated a Normal Distribution, and these are confirmed by the histograms below. 

Plot Note: The same distribution with a smaller bin width is also provided next to the original plot to highlight a deeper look at the distribution and in turn confirm that the normal distribution is rarely a perfectly bell shaped curve

```{r echo=FALSE, message=FALSE, warning=FALSE}
# distributions for some key variables with bins adjusted
p1 <- qplot(x = pH, data = wine)
b1 <- qplot(x = pH, data = wine, bins=50, xlab = "pH (bins adjusted)")
p2 <- qplot(x = density, data = wine)
b2 <- qplot(x = density, data = wine, bins=50, xlab = "density (bins adjusted)")
grid.arrange(p1,b1, p2,b2, ncol = 2)
```

For the remaining variables, we had previously identified possible skews on the normal distribution. We will plot this visually and confirm that the extent of the skews and also confirm if transformations result in a normal distribution. 

Plot Note: R allows for an iterative approach to plotting. The plots below were plotted by just identifying the x axis, and were then further refined, by adjusting factors like *binwidth* and *breaks*, to present the final visual distribution

Among the remaining variable to be observed, it can be seen that *fixed.acidity* is very close to a normal distribution. However like the variables [*'residual.sugar', 'sulphates', 'total.sulfur.dioxide', 'chlorides'*], the distribution has a long tail and would benefit with a transformation.

```{r echo=FALSE, message=FALSE, warning=FALSE}
p11 <- qplot(x = fixed.acidity, data = wine, binwidth = 0.1)
p12 <- qplot(x = residual.sugar, data = wine, binwidth = 0.125)
p13 <- qplot(x = total.sulfur.dioxide, data = wine, binwidth = 2)
p14 <- qplot(x = chlorides, data = wine, binwidth = 0.0025)
grid.arrange(p11,p12,p13,p14, ncol=2)
```

The variable *free.sulfur.dioxide* seems discrete after bins are shortened. This can probably also be constituted to rounding. It is interesting to see that the distribution does seem to exhibit a long trailing tail, so a transformation should be attempted

```{r echo=FALSE, message=FALSE, warning=FALSE}
p21 <- qplot(x = free.sulfur.dioxide, data = wine, binwidth = 1, xlab = 'free.sulfur.dioxide')
p22 <- qplot(x = free.sulfur.dioxide, data = wine, binwidth = 0.5, xlab = 'free.sulfur.dioxide(smaller binwidth)')
grid.arrange(p21,p22, ncol = 2)
```

* Plotting the remaining variables we can see that the variables [*volatile.acidity, alcohol, citric.acid*] have many peaks and do not have a trailing tail. It is not expected for this distributions to normalize after a log transformation. Further evaluations need to be made using subsets and groupings of these variables to evaluate the effect on 'quality' in the Bivariate and Multivariate sections. It can also be seen that variable *citric.acid*  has a very large number of 0 values, so it is not a good candidate to use to determine correlation to *quality*.

```{r echo=FALSE, message=FALSE, warning=FALSE}
p31 <- qplot(x = volatile.acidity, data = wine, binwidth = 0.0125) + 
  scale_x_continuous(breaks = seq(0,1.6,0.4))
p32 <- qplot(x = citric.acid, data = wine, binwidth = 0.0125)
p33 <- qplot(x = alcohol, data = wine, binwidth = 0.125)
grid.arrange(p31,p32,p33, ncol=2)
```

**Transformations for Normal distributions**
Here, we will continue transforming the variables in an attempt to get a normal bell shaped distribution. For the variables [*fixed.acidity, residual.sugar, sulphates, total.sulfur.dioxied, 'chlorides'*] we transformed the distributions using log10 and observed a more normal distribution

Plot Note: It was also evident from the earlier plots that outliers are present for the variables, so only the top 99th percentile will be used to represent the distribution

Readme Note: Previous plots were done using *qplot*. Plots moving forward will be done using *ggplot* allowing for the iterative approach to plotting while allowing for more control and refinement. For example in the plots below one variable [*p1*] is assigned the basic plot, and then the variation is created by *l1 = p1 + coord_trans(x = 'log10')*

```{r echo=FALSE, message=FALSE, warning=FALSE}
#plots with scale adjusted to log10. Quantiles also adjusted to identify the normal distribution clearly
# Observe fixed.acidity
p1 = ggplot(data=wine, aes(x=fixed.acidity)) + 
  geom_histogram(
    limits = c(0,quantile(wine$fixed.acidity, 0.99)),binwidth = 0.1)
# add log scale
l1 = p1 + coord_trans(x = 'log10') + xlab('fixed acidity log10')
# compare the two scales
grid.arrange(p1,l1,  ncol = 2)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Observe residual.sugar 
p1 = ggplot(data=wine, aes(x=residual.sugar)) + 
  geom_histogram(
    limits = c(0,quantile(wine$residual.sugar, 0.99)), binwidth = 0.125)
l1 = p1 + coord_trans(x = 'log10') + xlab('residual sugar log10')
grid.arrange(p1,l1,  ncol = 2)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Observe sulphates
p1 = ggplot(data=wine, aes(x=sulphates)) + 
  geom_histogram(
    limits = c(0,quantile(wine$sulphates, 0.99)), binwidth = 0.025)
l1 = p1 + coord_trans(x = 'log10') + xlab('sulphates log10')
grid.arrange(p1,l1,  ncol = 2)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Observe total.sulfur.dioxide
p1 = ggplot(data=wine, aes(x=total.sulfur.dioxide)) + 
  geom_histogram(
    limits = c(0,quantile(wine$total.sulfur.dioxide, 0.99)), binwidth = 2)
l1 = p1 + coord_trans(x = 'log10') + xlab('total sulfur dioxide log10')
grid.arrange(p1,l1,  ncol = 2)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Observe chlorides
p1 = ggplot(data=wine, aes(x=chlorides)) + 
  geom_histogram(
    limits = c(0,quantile(wine$chlorides, 0.99)), binwidth = 0.0025)
l1 = p1 + coord_trans(x = 'log10') + xlab('chlorides log10')
grid.arrange(p1,l1,  ncol = 2)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
p1 = ggplot(data=wine, aes(x=volatile.acidity)) + 
  geom_histogram(binwidth = 0.025)
l1 = p1 + coord_trans(x = 'log10') + xlab('volatile acidity log10')
grid.arrange(p1,l1, ncol=2)
```

**Unable to Normalize**
The plots below show the unsuccessful transformation of the variables *free sulfur dioxide*, *alcohol* and *citric acid* due the inability to normalize after applying transformations. It is difficult to form a conclusion on these and will require further investigation in bi-variate analysis. In later analysis the data can be subset to remove any null values.

```{r echo=FALSE, message=FALSE, warning=FALSE}
p1 = ggplot(data=subset(wine, free.sulfur.dioxide != 0), 
            aes(x=free.sulfur.dioxide)) + geom_histogram(binwidth = 1)
l1 = p1 + coord_trans(x = 'log10') + xlab('free sulfur dioxide log10')
p2 = ggplot(data=wine, aes(x=alcohol)) + geom_histogram(binwidth = 0.125)
l2 = p2 + coord_trans(x = 'log10') + xlab('alcohol log10')
p3 = ggplot(data=subset(wine, citric.acid!=0), aes(x=citric.acid)) + 
  geom_histogram(binwidth = 0.0125)
l3 = p3 + coord_trans(x = 'log10') + xlab('citric acid log10')

grid.arrange( p1,l1, p3,l3, p2,l2,   ncol = 2)
```



### Univariate Analysis - Summary

* **Structure**: Dataset consists of 1599 observations for a total of 12 variables. A *quality* categorial variable for the quality of the wine, which has been converted to a *factor* datatype and split up into three categories for the different qualities of wine. The other 11 variables are the different features of the wine that might constitute towards the quality of the red wine.
* **Main Features**: Main features of interest is the *quality* of the wine and essentially determine which of the supporting variables make the wine taste good or bad. The variables *pH* and *density* showed a are worth looking into. The different acid variables are also features worth checking correlation with.
* **New Variables**: The 'quality' variable was adjusted to be a factor type variable of 3 distinct quality levels that will help in the analysis by grouping in the upcoming analysis
* **Other adjustments** First adjustment was to remove the index column as it served no purpose. The variables [*fixed.acidity, residual.sugar, sulphates, total.sulfur.dioxide, chlorides*] were adjusted to include the 99th percentile, which means that outliers in the top 1% were excluded. Then a logarithimic transformation was applied to determine a normal distribution. 
* *Further investigation needed*: The variables [*alcohol, citric.acid, free.sulfur.dioxide*] that do not fit into the logarithmic normal distribution and will require further analsyis


# Bivariate Plots Section

In this section we will observe the correlation of quality to the different variables. We had previously reduced the qine quality score to three values. We will compare this discrete quality values with the other continuous wine variables and identify trends using Box Plots

In the plots below forr *fixed acidity, volatile acidity, citric acid, sulphates, alcohol* we can see a general trend indicating a change in quality score influenced by a change in value of these variables. Within these variables, *alcohol* content seems to be the only exception where 'bad' and 'good' quality wines are not impacted by alcohol content. But it is worth including as a dependant variable as the 'best' quality wines seem to be determined by the higher alcohol content. 

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots}
# boxplots for previously identified influential variables
b1 = ggplot(aes(y = fixed.acidity, x = quality), data = wine) + 
      geom_boxplot()
b2 = ggplot(aes(y = volatile.acidity, x = quality), data = wine) + 
      geom_boxplot()
b3 = ggplot(aes(y = citric.acid, x = quality), data = wine) + 
      geom_boxplot()
b4 = ggplot(aes(y = sulphates, x = quality), data = wine) + 
      geom_boxplot()
b5 = ggplot(aes(y = alcohol, x = quality), data = wine) + 
      geom_boxplot()
grid.arrange(b1,b2,b3,b4,b5, ncol = 3)

```


Whereas the plots for *residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide, density, pH* do not indicate a correlation to the quality score of the wine. You can see from the plots below that for the different values within each variabe, the box plots indicating the distribution for the quality scores are generally identical ,or the differences of distribution is insignificant

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Remaining box plots for variables with little influence on quality
b6 = ggplot(aes(y = residual.sugar, x = quality), data = wine) + 
      geom_boxplot()
b7 = ggplot(aes(y = chlorides, x = quality), data = wine) + 
      geom_boxplot()
b8 = ggplot(aes(y = free.sulfur.dioxide, x = quality), data = wine) + 
      geom_boxplot()
b9 = ggplot(aes(y = total.sulfur.dioxide, x = quality), data = wine) + 
      geom_boxplot()
b10 = ggplot(aes(y = density, x = quality), data = wine) + 
      geom_boxplot()
b11 = ggplot(aes(y = pH, x = quality), data = wine) + 
      geom_boxplot()
grid.arrange(b6,b7,b8,b9,b10,b11, ncol=3)
```

While building a model to identify correlation it is important to identify bias by verifying that the variables are in fact independent. Below we will check verify correlation using scatter plots.

It is good to see that while the variables *fixed acidity* and *volatile acidity* were indicated to show an effect on *quality* score, we can confirm that in fact they have have a WEAK negative correlation within themselves

```{r echo=FALSE, message=FALSE, warning=FALSE}
# scatter plot with best fit line
ggplot(aes(x = fixed.acidity, y = volatile.acidity), data = wine) + 
  geom_point(alpha = 1/5) +
  stat_smooth(method = 'lm')	
# with a correlation of 
with(wine, cor.test(fixed.acidity, volatile.acidity, method = 'pearson'))
```

The variables, *fixed acidity* and *citric acid*, on the other is just below the STRONG positive correlation

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = fixed.acidity, y = citric.acid), data = wine) + 
  geom_point(alpha = 1/5) +
  stat_smooth(method = 'lm')	
# with a correlation of 
with(wine, cor.test(fixed.acidity, citric.acid, method = 'pearson'))
```

While the Varaibles, *volatile acidity* and *citric acid* are not strongly correlated either

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = volatile.acidity, y = citric.acid), data = wine) + 
  geom_point(alpha = 1/5) +
  stat_smooth(method = 'lm')	
# with a correlation of 
with(wine, cor.test(volatile.acidity, citric.acid, method = 'pearson'))
```

**Observing pH correation with acid levels**: It is interesting to see the 'pH' doesn't have much of an effect while the different acidity levels does. Below, we will continue to spot correlations within the variables that influence *quailty*. 

* Both *citric.acid* and *fixed.acidity* have the expected negative correlation with pH, however the variable *volatile.acidity* has a weak correlation of ~0.23. This confirms that *Volatile acidity* constitutes strongly to the quality of the wine, while not having a significant effect on the pH of the wine

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Scatter plot with best fit lines comparing different acidity levels with pH
a1 = ggplot(aes(x = citric.acid, y = pH), data = wine) + 
  geom_point(alpha = 1/5) +
  stat_smooth(method = 'lm')
a2 = ggplot(aes(x = fixed.acidity, y = pH), data = wine) + 
  geom_point(alpha = 1/5) +
  stat_smooth(method = 'lm')
a3 = ggplot(aes(x = volatile.acidity, y = pH), data = wine) + 
  geom_point(alpha = 1/5) +
  stat_smooth(method = 'lm')
grid.arrange(a1,a2,a3, ncol=3)
with(wine, cor.test(volatile.acidity, pH, method = 'pearson'))
```

Below, we continue looking at the other correlations that do not affect *quality*. These are captured if it becomes necessary as the model is further enhanced when evaluating 'White Wine' data. But for our purposes looking at just 'Red Wine' data we have seen before that they do not affect *quality* scores. It is also worth noting that the univariate analysis had identified prime candidates in *pH* and *density* as independent variables due to the normal distributions but then rejected as valide candidates once the correlation to the dependant variable *quality* showed an insignificant effect.

*free sulfur dioxide* and *total sulfur dioxide* has a strong positive correlation

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = free.sulfur.dioxide, y = total.sulfur.dioxide), data = wine) + 
  geom_point(alpha = 1/5) +
  stat_smooth(method = 'lm')	
# with a correlation of 
with(wine, 
     cor.test(free.sulfur.dioxide, total.sulfur.dioxide, method = 'pearson'))
```

The variables *total sulfur dioxide* and *sulphates*, unlike above,  has no correlation

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = total.sulfur.dioxide, y = sulphates), data = wine) + 
  geom_point(alpha = 1/5) +
  stat_smooth(method = 'lm')	
# with a correlation of 
with(wine, cor.test(total.sulfur.dioxide, sulphates, method = 'pearson'))
```

Even though *sulphates* does not have any correlation to *total sulfur dioxide*, it does seem to have a medium strength correlation to acid levels, primarily *citric acid* as seen below

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = sulphates, y = volatile.acidity), data = wine) + 
  geom_point(alpha = 1/5) +
  stat_smooth(method = 'lm')	
# with a correlation of 
with(wine, cor.test(citric.acid, sulphates, method = 'pearson'))
```

*density* and *alcohol* have a medium strength negative correlation

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = density, y = alcohol), data = wine) + 
  geom_point(alpha = 1/5) +
  stat_smooth(method = 'lm')	
# with a correlation of 
with(wine, cor.test(density, alcohol, method = 'pearson'))
```


### Bivariate Analysis - Summary

* **Features of Interest**: The plots for *fixed acidity, volatile acidity, citric acid, sulphates, alcohol* indicate an influence  on the quality. *Alcohol* content is an exception among these as it has there is not affect on the 'low' and 'medium' scored qualities. The distinction is seen with the 'best' quality wines where a a higher alcohol content indcates an improvement in *quality*. 
* **Non-main features of interest**: *Citric acid* have negative correlation with *volatile acidity* while *citric acid* has a positive correlation with *fixed acidity*. *alcohol* and *density* has a medium strength negative correlation
* **Strongest Relationship**:  *volatile.acidity* in its affect on *quality* as seen in the box plot shows the clearest separation of distribution for each *quality* scores. It is also worth noting that *fixed acidity* and *citric acid* are independant variables that have a mid-strong level correlation


# Multivariate Plots Section

In this section we are going to further enhance the analysis earlier and take steps to identify correlations while faceting by the *quality* factors. 

Looking at the strong correlation between *fixed.acidity* and *citric.acid*. Once separated by *quality* we can see an indication for higher quality when levels for *fixed.acidity* and *citric.acid* are higher

```{r  echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots}
p1 <- ggplot(aes(x=citric.acid, y=fixed.acidity, color = quality),data = wine) + 
        geom_point() +
        scale_color_brewer(type = 'div',guide = guide_legend(title = 'Quality',
                                                             reverse = T)) +
        ggtitle("All qualities highlighting 'low' vs 'high' quality") 
p2 <- ggplot(aes(x=citric.acid, y=fixed.acidity), data = wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        ggtitle("Separated by quality")
grid.arrange(p1,p2)
```

Now looking at the MEDIUM strength correlation of *volatile.acidity* and *citric.acid*. A concentration of low volatile acidity also seems evident for 'high' quality wine

```{r  echo=FALSE, message=FALSE, warning=FALSE}
p1 <- ggplot(aes(x=citric.acid,y=volatile.acidity,color = quality),data = wine) + 
        geom_point() +
        scale_color_brewer(type = 'div',
                        guide = guide_legend(title = 'Quality', reverse = T)) +
        ggtitle("All qualities highlighting 'low' vs 'high' quality") 
p2 <- ggplot(aes(x=citric.acid, y=volatile.acidity), data = wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        ggtitle("Separated by quality")
grid.arrange(p1,p2)
```



Finally, also comparing *citric.acid* to *sulphates*. Higher *sulphate* also improve quality, with a key indication to distinguish 'medium' quality from 'low' quality, as increasing *Sulphates* doesn't seem to be an indicator distinguishing 'high' quality wines from 'medium' ones.

```{r  echo=FALSE, message=FALSE, warning=FALSE}
p1 <- ggplot(aes(x=citric.acid, y=sulphates, color = quality), data = wine) + 
        geom_point() +
        scale_color_brewer(type = 'div',
                        guide = guide_legend(title = 'Quality', reverse = T)) +
        ggtitle("All qualities highlighting 'low' vs 'high' quality") 
p2 <- ggplot(aes(x=citric.acid, y=sulphates), data = wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        ggtitle("Separated by quality")
grid.arrange(p1,p2)
```

The confusion for the influence of *alcohol* is evident from these plots with a high variance in the plots for both 'average' and 'high' quality wine, but the concentration for the plot pattern in 'high' quality indicates an influence in quality for higher values of *alcohol*

```{r  echo=FALSE, message=FALSE, warning=FALSE}
p1 <- ggplot(aes(x=citric.acid, y=alcohol, color = quality), data = wine) + 
        geom_point() +
        scale_color_brewer(type = 'div',
                        guide = guide_legend(title = 'Quality', reverse = T)) +
        ggtitle("All qualities highlighting 'low' vs 'high' quality") 
p2 <- ggplot(aes(x=citric.acid, y=alcohol), data = wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        ggtitle("Separated by quality")
grid.arrange(p1,p2)
```

It would interesting to further observe the influence of alcohol. This time we plot *alcohol* against *density*. We confirm the similar concentration of points within the 11-13 alcohol axis in the 'high' quality section

```{r  echo=FALSE, message=FALSE, warning=FALSE}
p1 <- ggplot(aes(x=density, y=alcohol, color = quality), data = wine) + 
        geom_point() +
        scale_color_brewer(type = 'div',
                        guide = guide_legend(title = 'Quality', reverse = T)) +
        ggtitle("All qualities highlighting 'low' vs 'high' quality") 
p2 <- ggplot(aes(x=density, y=alcohol), data = wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        ggtitle("Separated by quality")
grid.arrange(p1,p2)
```

Some useful insight from the plots showing that the different levels of variables [*citric.acid, fixed.acidity, volatile.acidity, suplphates, alcohol*] does in fact influence *quality*. Better insight can be achieved by creating another variable which includes a discrete view by splitting up the continuous variables into buckets.

Using the top 99.5% percentile for the variables [*citiric.acid, fixed.acidity, volatile.acidity, sulphates, alcohol*] and split it up into 3 equal buckets. 

Using the *dplyr* library, we create three equal buckets by using the 95th quantile and splitting it into three using the cut() function

```{r echo=FALSE, message=FALSE, warning=FALSE}
#dplyr notation to create 95th quantile
citric_wine <- wine %>% filter(citric.acid < quantile(citric.acid, 0.995)) 
# attach so that we can work with the columns in 'citric_Wine'
attach(citric_wine)
# 3 equal sized buckets 
diff = (max(citric.acid) - min(citric.acid))/3
citric_wine$citric.acid.bucket <- cut(citric.acid, 
                                      c(min(citric.acid), 
                                        min(citric.acid)+diff,
                                        min(citric.acid)+2*diff, 
                                        max(citric.acid)), 
                                      include.lowest = TRUE)
detach(citric_wine)
#assign to p1 to use later in grid.arrange
p1 <- qplot(citric.acid.bucket, data = citric_wine)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
fixed_wine <- wine %>% filter(fixed.acidity < quantile(fixed.acidity, 0.995)) 
attach(fixed_wine)
diff = (max(fixed.acidity) - min(fixed.acidity))/3
fixed_wine$fixed.acidity.bucket <- cut(fixed.acidity, 
                                       c(min(fixed.acidity), 
                                        min(fixed.acidity)+diff, 
                                        min(fixed.acidity)+2*diff, 
                                        max(fixed.acidity)), 
                                       include.lowest = TRUE)
detach(fixed_wine)
#p2 for the fixed acidity bucket
p2 <- qplot(fixed.acidity.bucket, data = fixed_wine)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
volatile_wine <- wine %>% 
  filter(volatile.acidity < quantile(volatile.acidity, 0.995)) 
attach(volatile_wine)
diff = (max(volatile.acidity) - min(volatile.acidity))/3
volatile_wine$volatile.acidity.bucket <- cut(volatile.acidity, 
                                             c(min(volatile.acidity), 
                                               min(volatile.acidity)+diff, 
                                               min(volatile.acidity)+2*diff, 
                                               max(volatile.acidity)), 
                                             include.lowest = TRUE)
detach(volatile_wine)
#p3 for the volatile acidity bucket
p3 <- qplot(volatile.acidity.bucket, data = volatile_wine)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
sulphates_wine <- wine %>% filter(sulphates < quantile(sulphates, 0.995)) 
attach(sulphates_wine)
diff = (max(sulphates) - min(sulphates))/3
sulphates_wine$sulphates.bucket <- cut(sulphates, 
                                       c(min(sulphates), 
                                         min(sulphates)+diff, 
                                         min(sulphates)+2*diff, 
                                         max(sulphates)), 
                                       include.lowest = TRUE)
detach(sulphates_wine)
p4 <- qplot(sulphates.bucket, data = sulphates_wine)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
alcohol_wine <- wine %>% filter(alcohol < quantile(alcohol, 0.995)) 
attach(alcohol_wine)
diff = (max(alcohol) - min(alcohol))/3
alcohol_wine$alcohol.bucket <- cut(alcohol, 
                                   c(min(alcohol), 
                                     min(alcohol)+diff, 
                                     min(alcohol)+2*diff, 
                                     max(alcohol)), 
                                   include.lowest = TRUE)
detach(alcohol_wine)
p5 <- qplot(alcohol.bucket, data = alcohol_wine)

# grid arrange to show the buckets for the 5 significant factors
grid.arrange(p1,p2,p3,p4,p5, ncol=2)
```

Using bucket for *fixed.acidity*, plotting *citric.acid* against *sulphates*, we can identify the different levels of *fixed.acidity* and *Citric.acid* that improve quality

**Using *vixed.acidity* bucket**: The 0.25 *citric acid* and '4.6-7.73' (in green) *fixed acidity* level is common for 'average' level wine and almost non existent for 'high' quality, indicates a 'sweet spot' to avoid for that extra level of quality

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x=sulphates, y=citric.acid, color = fixed.acidity.bucket), 
       data = fixed_wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        scale_color_brewer(type = 'qual', 
                           guide = guide_legend(title = 'Fixed Acidity', 
                                                reverse = T))
```



**Using *citric.acid* buckets**: The plot patterns are similar for 'average' and 'high', however the lower bucket of 'citric acid' (in green) is non existent in the 'high' quality plot just under the 3.4 level 'pH' mark, indicating another 'sweet spot'

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x=volatile.acidity, y=pH, color = citric.acid.bucket), 
       data = citric_wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        scale_color_brewer(type = 'qual', 
                           guide = guide_legend(title = 'Citric Acidity', 
                                                reverse = T))
```



**Using *volatile.acidity* buckets**: Low levels of 'volatile.acidity' also affects the quality of the wine. The buckets of 'volatile acidity' creates a clear picture on quality. The lowest level on the 'volatile acidity' bucket (in green) is more prevalent in the 'high' quality wine, and mid level bucket of 'volatile acidity' is also quite evident in the 'average' quality wine

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x=fixed.acidity, y=citric.acid, color = volatile.acidity.bucket), 
       data = volatile_wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        scale_color_brewer(type = 'qual', 
                           guide = guide_legend(title = 'Volatile Acidity', 
                                                reverse = T))
```



**Using *alcohol* buckets**: low level alcohol buckets '8.4 - 10.1' (in green) is almost non-existent for 'high' quality wine

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x=fixed.acidity, y=citric.acid, color = alcohol.bucket), 
       data = alcohol_wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        scale_color_brewer(type = 'qual', 
                           guide = guide_legend(title = 'Alcohol', reverse = T))
```



**Using *sulphates* buckets**: Mid level *sulphates* (in purple) seem to have the strongest influence on quality; *sulphate* levels also indicate a sweet spot. In 'high' quality wine, the mid level bucket for *sulphates* '0.673 - 1.02' (in purple) is the most prevalent, while the lowest *sulphate* bucket (in green) is almost non existent

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x=volatile.acidity, y=citric.acid, color = sulphates.bucket), 
       data = sulphates_wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        scale_color_brewer(type = 'qual', 
                           guide = guide_legend(title = 'Sulphates', 
                                                reverse = T))
```



**Another plot using the *sulphates* bucket**: While the lower bucket influence is not confirmed in this plot, it is clear that that mid level 'sulphate' bucket has a clear influcene on 'high' quality wine

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x=density, y = alcohol, color = sulphates.bucket), 
       data = sulphates_wine) +
  geom_point() +
  facet_wrap(~quality) + 
  scale_color_brewer(type = 'qual', 
                     guide = guide_legend(title = 'Sulphates', reverse = T))
```



### Multivariate Analysis - Summary

**Features of Interest**: There is some distinction that differentiates the three levels of *alcohol*. It should be noted that there isn't much data for the two extremes of the quality spectrum (high and low). Wine quality improves with increasing *citric.acid* levels. 'Mid' level and 'High' level *citric.acid* are prominent among the 'Average' and 'High' quality wines. Wine quality improves while reducing *volatile.acidity* levels. The mid range level for *volatile.acidity* (0.443-0.767) is very prominent among the 'Average level wines, while *volatile.acidity* at LOW levels (0.12-0.443) constitutes for 'High' wine quality. Wine quality improves while increasing *alcohol* levels. The highest range on *alcohol* levels (11.9-13.6) is quite prominent among the 'High' quality wines while almost non-existent among the 'Low' quality wines

**Interesting or surprising interactions between features**: There are 'sweet spots' for the different variables that improve quality: 
* The sweet spot for the variables like *fixed.acidity, citric acid, alcohol* are on the higher end, while the 'sweet spot' for *sulphates* is in the middle. The mid-range level for *sulphates* at 0.673-1.02 are prominent in the 'high' quality wines and non existent in the 'low' quality wines 
* *fixed.acidity* levels do not provide a clear enough distinction within the different levels. While the most common *fixed.acidity* level is on the lower end (4.6-7.73) for 'Low' quality wine, that level is still prominent in the 'Average' and 'High' quality wines

# Summary of all Analysis

### Plot One
The bi-variate plots for *fixed acidity*, *volatile acidity*, *citric acid*, *sulphates* indicate an influence  on the *quality*. 

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_One}
b1 = ggplot(aes(y = fixed.acidity, x = quality, fill = quality), data = wine) + 
      geom_boxplot() + 
      ylab("fixed acidity (g/dm^3)")
b2 = ggplot(aes(y = volatile.acidity, x = quality, fill = quality), data = wine) + 
      geom_boxplot() + 
      ylab("volatile acidity (g/dm^3)")
b3 = ggplot(aes(y = citric.acid, x = quality, fill = quality), data = wine) + 
      geom_boxplot() + 
      ylab("citric acid (g/dm^3)")
b4 = ggplot(aes(y = sulphates, x = quality, fill = quality), data = wine) + 
      geom_boxplot() + 
      ylab("(potassium sulphate - g/dm3)")
grid.arrange(b1,b2,b3,b4, ncol = 2, top = 'Box Plot identifying changes in Quality for different variables')

```


### Plot Two
Distinguishing the bivariate plot for *alcohol* as the high distribution of *alcohol' volume has a clear distinction in 'High' quality wines, while 'Average' and 'Low' quality wines do not have much of a distinction in alcohol volume.

```{r  echo=FALSE, message=FALSE, warning=FALSE, Plot_Two}
ggplot(aes(y = alcohol, x = quality, fill = quality), data = wine) + 
      geom_boxplot() + 
      ylab("alcohol (% by volume)") + 
      ggtitle("Quality of Red Wine based on alcohol content")
```

### Plot Three
The *quality* variable was the only discrete variable in this dataset so it was important to create a discrete version of  of *quality *by splitting the variable into equal buckets. Out of the different buckets used in the independent variables,  the sweet spot for *sulphates* in the mid range (0.673g/dm3 - 1.02 g/dm3) as being the 'sweet spot' for the influence of  on 'Average' and 'High' *quality*, while non-existent in 'Low' *quality*

```{r  echo=FALSE, message=FALSE, warning=FALSE, Plot_Three}
ggplot(aes(x=volatile.acidity, y=citric.acid, color = sulphates.bucket), 
       data = sulphates_wine) + 
        geom_point() + 
        facet_wrap(~quality) + 
        scale_color_brewer(type = 'qual', 
                           guide = guide_legend(title = 'sulphates (g/dm3)', 
                                                reverse = T)) + 
        xlab("volatile acidity (acetic acid - g/dm^3)") + 
        ylab("citric acid (g/dm^3)") + 
        ggtitle("Scatter Plot split up by Quality ('low', 'average', 'high')")
```


# Reflection

This dataset for red wine consists of only 1599 observations. The majority of the collected data fell in the the mid *quality* range (5 or 6) leaving very little data for the two extremes (low quality and high quality). This proved to be difficult to find definite proof of a strong correlation. Variables that influenced correlations were apparent from bi-variate analysis. Multivariate analysis was difficult due to every other variable other than quality is continuous. Even with forming discrete variables by forming buckets, a clear indication on the influence was not certain due to the very small numbers for 'high' and 'low' quality wine. 

A relative approach comparing the influences of different variables on the different types of wine would probably prove to be more fruitful, like determining factors that effect red wine and white wine differently. The analysis here is the useful first step to gain insight into how to approach that analysis.